{"version":3,"file":"headers.cjs","sources":["../../../src/ssr/headers.ts"],"sourcesContent":["import { splitSetCookieString } from 'cookie-es'\nimport type { OutgoingHttpHeaders } from 'node:http2'\n\n// A utility function to turn HeadersInit into an object\nexport function headersInitToObject(\n  headers: HeadersInit,\n): Record<keyof OutgoingHttpHeaders, string> {\n  const obj: Record<keyof OutgoingHttpHeaders, string> = {}\n  const headersInstance = new Headers(headers)\n  for (const [key, value] of headersInstance.entries()) {\n    obj[key] = value\n  }\n  return obj\n}\n\ntype AnyHeaders =\n  | Headers\n  | HeadersInit\n  | Record<string, string>\n  | Array<[string, string]>\n  | OutgoingHttpHeaders\n  | undefined\n\n// Helper function to convert various HeaderInit types to a Headers instance\nfunction toHeadersInstance(init: AnyHeaders) {\n  if (init instanceof Headers) {\n    return new Headers(init)\n  } else if (Array.isArray(init)) {\n    return new Headers(init)\n  } else if (typeof init === 'object') {\n    return new Headers(init as HeadersInit)\n  } else {\n    return new Headers()\n  }\n}\n\n// Function to merge headers with proper overrides\nexport function mergeHeaders(...headers: Array<AnyHeaders>) {\n  return headers.reduce((acc: Headers, header) => {\n    const headersInstance = toHeadersInstance(header)\n    for (const [key, value] of headersInstance.entries()) {\n      if (key === 'set-cookie') {\n        const splitCookies = splitSetCookieString(value)\n        splitCookies.forEach((cookie) => acc.append('set-cookie', cookie))\n      } else {\n        acc.set(key, value)\n      }\n    }\n    return acc\n  }, new Headers())\n}\n"],"names":["splitSetCookieString"],"mappings":";;;AAIO,SAAS,oBACd,SAC2C;AAC3C,QAAM,MAAiD,CAAA;AACvD,QAAM,kBAAkB,IAAI,QAAQ,OAAO;AAC3C,aAAW,CAAC,KAAK,KAAK,KAAK,gBAAgB,WAAW;AACpD,QAAI,GAAG,IAAI;AAAA,EACb;AACA,SAAO;AACT;AAWA,SAAS,kBAAkB,MAAkB;AAC3C,MAAI,gBAAgB,SAAS;AAC3B,WAAO,IAAI,QAAQ,IAAI;AAAA,EACzB,WAAW,MAAM,QAAQ,IAAI,GAAG;AAC9B,WAAO,IAAI,QAAQ,IAAI;AAAA,EACzB,WAAW,OAAO,SAAS,UAAU;AACnC,WAAO,IAAI,QAAQ,IAAmB;AAAA,EACxC,OAAO;AACL,WAAO,IAAI,QAAA;AAAA,EACb;AACF;AAGO,SAAS,gBAAgB,SAA4B;AAC1D,SAAO,QAAQ,OAAO,CAAC,KAAc,WAAW;AAC9C,UAAM,kBAAkB,kBAAkB,MAAM;AAChD,eAAW,CAAC,KAAK,KAAK,KAAK,gBAAgB,WAAW;AACpD,UAAI,QAAQ,cAAc;AACxB,cAAM,eAAeA,SAAAA,qBAAqB,KAAK;AAC/C,qBAAa,QAAQ,CAAC,WAAW,IAAI,OAAO,cAAc,MAAM,CAAC;AAAA,MACnE,OAAO;AACL,YAAI,IAAI,KAAK,KAAK;AAAA,MACpB;AAAA,IACF;AACA,WAAO;AAAA,EACT,GAAG,IAAI,SAAS;AAClB;;;"}